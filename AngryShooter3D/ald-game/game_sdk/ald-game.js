!function(){function s(e){var t={};return"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e,n){t["[object "+e+"]"]=e.toLowerCase()}),null==e?e:"object"==typeof e||"function"==typeof e?t[function(e){return Object.prototype.toString.call(e)}.call(e)]||"object":typeof e}function c(e,s){g++,e.as=w,e.at=v,e.rq_c=g,e.ifo=r,e.ak=a.app_key,e.uu=o,e.v=t,e.st=Date.now(),e.ev=s,e.wsr=p,""!==function(e){if(void 0===e||""===e)return"";var t={};for(var n in e)"rawData"!=n&&"errMsg"!=n&&(t[n]=e[n]);return t}(e.ufo)&&(e.ufo=e.ufo),e.ec=h,wx.Queue.push(function(){return new Promise(function(t,a){wx.request({url:"https://"+n+".aldwx.com/d.html",data:e,header:{se:u||"",op:l||"",img:S||""},method:"GET",fail:function(){t("")},success:function(e){t(200==e.statusCode?"":"status error")}})})})}function d(e){var t={};for(var n in e)t[n]=e[n];return t}function f(e){for(var t="",n=0;n<e.length;n++)e[n].length>t.length&&(t=e[n]);return t}var t="2.0.0",n="glog",a=require("./ald-game-conf");""===a.app_key&&console.error("请在配置文件中填写您的app_key"),a.app_key=a.app_key.replace(/\s/g,""),wx.request({url:"https://"+n+".aldwx.com/config/app.json",method:"GET",success:function(e){200===e.statusCode&&(e.data.version!=t&&console.warn("您的SDK不是最新版本，请尽快升级！"),e.data.warn&&console.warn(e.data.warn),e.data.error&&console.error(e.data.error))}});var r="",o=function(){var e="";try{e=wx.getStorageSync("aldstat_uuid"),wx.setStorageSync("ald_ifo",!0)}catch(t){e="uuid_getstoragesync"}if(e)r=!1;else{e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}(),r=!0;try{wx.setStorageSync("aldstat_uuid",e)}catch(e){wx.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return e}(),i={},u="",l="",h=0,g="",p=wx.getLaunchOptionsSync(),m=Date.now(),v=""+Date.now()+Math.floor(1e7*Math.random()),w=""+Date.now()+Math.floor(1e7*Math.random()),_=0,y="",S="",x=!0,q=!1,I=["aldSendEvent","aldOnShareAppMessage","aldShareAppMessage","aldSendSession","aldSendOpenid","aldLevelEvent"],b=["payStart","paySuccess","payFail","die","revive","tools","award"],M=["complete","fail"];void 0===wx.Queue&&(wx.Queue=new function(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(n,a){var s=function(){e.activeCount++,t().then(function(e){n(e)}).then(function(){e.next()})};e.activeCount<e.concurrency?s():e.queue.push(s)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,e.queue.length>0&&e.queue.shift()()}},wx.Queue.all()),Promise.all([new Promise(function(e,t){wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){S=f(t.userInfo.avatarUrl.split("/")),e(t)},fail:function(){e("")}}):e("")},fail:function(){e("")}})}),new Promise(function(e,t){wx.getNetworkType({success:function(t){e(t)},fail:function(){e("")}})}),new Promise(function(e,t){a.getLocation?wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}):wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]?(wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}),e("")):e("")},fail:function(){e("")}})})]).then(function(e){""!==e[2]?(i.lat=e[2].latitude||"",i.lng=e[2].longitude||"",i.spd=e[2].speed||""):(i.lat="",i.lng="",i.spd=""),""!==e[1]?i.nt=e[1].networkType||"":i.nt="";var t=d(i);""!==e[0]&&(t.ufo=e[0],y=e[0]),c(t,"init")}),wx.onShow(function(e){if(p=e,_=Date.now(),!x&&!q){v=""+Date.now()+Math.floor(1e7*Math.random()),r=!1;try{wx.setStorageSync("ald_ifo",!1)}catch(e){}}x=!1,q=!1;var t=d(i),n=d(i);t.sm=_-m,e.query.ald_share_src&&e.shareTicket&&"1044"===e.scene?(n.tp="ald_share_click",new Promise(function(e,t){"1044"==p.scene?wx.getShareInfo({shareTicket:p.shareTicket,success:function(t){e(t)},fail:function(){e("")}}):e("")}).then(function(e){n.ct=e,c(n,"event")})):e.query.ald_share_src&&(n.tp="ald_share_click",n.ct="1",c(n,"event")),c(t,"show")}),wx.onHide(function(){var e=d(i);e.dr=Date.now()-_,""===y?wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){e.ufo=t,y=t,S=f(t.userInfo.avatarUrl.split("/")),c(e,"hide")}}):c(e,"hide")}}):c(e,"hide")}),wx.onError(function(e){var t=d(i);t.tp="ald_error_message",t.ct=e,h++,c(t,"event")});var k={aldSendEvent:function(e,t){var n=d(i);""!==e&&"string"==typeof e&&e.length<=255?(n.tp=e,"string"==typeof t&&t.length<=255?(n.ct=String(t),c(n,"event")):"object"==typeof t?(JSON.stringify(t).length>=255&&console.error("自定义事件参数不能超过255个字符"),n.ct=JSON.stringify(t),c(n,"event")):void 0===t||""===t?c(n,"event"):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符")):console.error("事件名称必须为String类型且不能超过255个字符")},aldOnShareAppMessage:function(e){wx.onShareAppMessage(function(){q=!0;var t=e(),n="";n=void 0!==p.query.ald_share_src?void 0!==t.query?(p.query.ald_share_src.indexOf(o),t.query+"&ald_share_src="+p.query.ald_share_src+","+o):(p.query.ald_share_src.indexOf(o),"ald_share_src="+p.query.ald_share_src+","+o):void 0!==t.query?t.query+"&ald_share_src="+o:"ald_share_src="+o,"undefined"!=s(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n;var a=d(i);return a.ct=t,a.ct.sho=1,a.tp="ald_share_chain",c(a,"event"),t})},aldShareAppMessage:function(e){q=!0;var t=e,n="";n=void 0!==p.query.ald_share_src?void 0!==t.query?(p.query.ald_share_src.indexOf(o),t.query+"&ald_share_src="+p.query.ald_share_src+","+o):(p.query.ald_share_src.indexOf(o),"ald_share_src="+p.query.ald_share_src+","+o):void 0!==t.query?t.query+"&ald_share_src="+o:"ald_share_src="+o;var a=d(i);"undefined"!=s(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n,a.ct=t,a.tp="ald_share_chain",c(a,"event"),wx.shareAppMessage(t)},aldSendSession:function(e){if(""!==e&&e){var t=d(i);t.tp="session",t.ct="session",u=e,""===y?wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){t.ufo=e,c(t,"event")}}):c(t,"event")}}):(t.ufo=y,""!==y&&(t.gid=""),c(t,"event"))}else console.error("请传入从后台获取的session_key")},aldSendOpenid:function(e){if(""!==e&&e){l=e;var t=d(i);t.tp="openid",t.ct="openid",c(t,"event")}else console.error("openID不能为空")}};wx.aldStage=new function(){function e(e){return!/^\d+(.\d+)*$/.test(e.stageId)||e.stageId.length>32?(console.warn("关卡stageId必须符合传参规则,请参考文档。"),!1):!("string"!==s(e.stageName)||e.stageName.length>32)||(console.warn("关卡名称为必传字段,且长度小于32个字符,请参考文档"),!1)}var t="",n="",a=0;this.onStart=function(r){if(e(r)){var o={};a=Date.now(),o.sid=r.stageId,o.snm=r.stageName,o.state="start",n=""+Date.now()+Math.floor(1e7*Math.random()),t=o,("string"===s(r.userId)&&r.userId)<32&&(this.uid=r.uid),this.request()}},this.onRunning=function(n){if(e(n)){var a={params:{}};if(("string"===s(n.userId)&&n.userId)<32&&(this.uid=n.uid),!s(n.event)&&-1!=b.join(",").indexOf(n.event+","))return void b.join(",");if(a.event=n.event,"object"===s(n.params)){if("string"!==s(n.params.itemName)||n.params.itemName.length>32)return void console.warn("道具/商品名称为必传字段，且长度小于32个字符，详情请参考文档");a.params.itnm=n.params.itemName,"string"===s(n.params.itemId)&&n.params.itemId.length<32&&(a.params.itid=n.params.itemId),"number"===s(n.params.itemCount)&&n.params.itemCount.length<32?a.params.itco=n.params.itemCount:a.params.itco=1,-1!==n.event.indexOf("pay")&&("number"===s(n.params.itemMoney)&&n.params.itemMoney.length<32?a.params.money=n.params.itemMoney:a.params.money=0),"string"===s(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),a.state="running",a.sid=n.stageId,a.snm=n.stageName,t=a,this.request()}}},this.onEnd=function(n){if(e(n)){var r={state:"end"};if(("string"===s(n.userId)&&n.userId)<32&&(this.uid=n.uid),!s(n.event)&&-1!==M.join(",").indexOf(n.event+","))return void M.join(",");r.sid=n.stageId,r.snm=n.stageName,r.event=n.event,r.sdr=0!==a?Date.now()-a:"",r.params={},"object"===s(n.params)&&"string"===s(n.params.desc)&&n.params.desc.length<64&&(r.params.desc=n.params.desc),t=r,this.request()}},this.request=function(){var e=d(i);t.ss=n,e.ct=t,c(e,"screen")}};for(var O=0;O<I.length;O++)!function(e,t){Object.defineProperty(wx,e,{value:t,writable:!1,enumerable:!0,configurable:!0})}(I[O],k[I[O]]);try{var j=wx.getSystemInfoSync();i.br=j.brand||"",i.md=j.model,i.pr=j.pixelRatio,i.sw=j.screenWidth,i.sh=j.screenHeight,i.ww=j.windowWidth,i.wh=j.windowHeight,i.lang=j.language,i.wv=j.version,i.sv=j.system,i.wvv=j.platform,i.fs=j.fontSizeSetting,i.wsdk=j.SDKVersion,i.bh=j.benchmarkLevel||"",i.bt=j.battery||"",i.wf=j.wifiSignal||"",i.lng="",i.lat="",i.nt="",i.spd="",i.ufo=""}catch(e){}}();